import discord
from discord.ext import commands
import random
import asyncio
from datetime import datetime, timedelta
from typing import Dict, List, Optional, Tuple

from config import Config
from core.logger import get_security_logger
from core.database import db_manager

logger = get_security_logger()

class SecurityQuizzes:
    """Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©"""
    
    def __init__(self):
        self.quizzes = {}
        self.active_quizzes = {}  # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø´Ø·
        self.user_scores = {}     # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -> Ø§Ù„Ù†Ù‚Ø§Ø·
        self.cooldowns = {}       # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -> ÙˆÙ‚Øª Ø¢Ø®Ø± Ø§Ø®ØªØ¨Ø§Ø±
        
    async def initialize(self):
        """ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"""
        try:
            await self._load_quizzes()
            logger.info("âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©")
        except Exception as e:
            logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: {e}")
            
    async def _load_quizzes(self):
        """ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª"""
        self.quizzes = {
            'basic_security': {
                'title': 'ğŸ”’ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
                'description': 'Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙƒ Ø¨Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø±Ù‚Ù…ÙŠ',
                'difficulty': 'easy',
                'time_limit': 300,  # 5 Ø¯Ù‚Ø§Ø¦Ù‚
                'questions': [
                    {
                        'question': 'Ù…Ø§ Ù‡ÙŠ Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©ØŸ',
                        'options': [
                            'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù…Ùƒ ÙˆØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ',
                            'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø²ÙŠØ¬ Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ²',
                            'Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø³ÙŠØ·Ø©',
                            'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª'
                        ],
                        'correct': 1,
                        'explanation': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚ÙˆÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø²ÙŠØ¬ Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØ§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø±Ù…ÙˆØ²'
                    },
                    {
                        'question': 'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø®Ø¯Ø§Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Phishing)ØŸ',
                        'options': [
                            'Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
                            'Ù…Ø­Ø§ÙˆÙ„Ø© Ø®Ø¯Ø§Ø¹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ©',
                            'Ø·Ø±ÙŠÙ‚Ø© Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
                            'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±'
                        ],
                        'correct': 1,
                        'explanation': 'Ø§Ù„Ø®Ø¯Ø§Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù‡Ùˆ Ù…Ø­Ø§ÙˆÙ„Ø© Ø®Ø¯Ø§Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ù… Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø§Ù„ÙŠØ©'
                    },
                    {
                        'question': 'Ù…ØªÙ‰ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ­Ø¯ÙŠØ« Ø¨Ø±Ø§Ù…Ø¬ÙƒØŸ',
                        'options': [
                            'Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„Ø³Ù†Ø©',
                            'Ø¹Ù†Ø¯Ù…Ø§ ØªØªÙˆÙØ± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©',
                            'ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø´Ø±Ø§Ø¡ Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯',
                            'Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø£Ø¨Ø¯Ø§Ù‹'
                        ],
                        'correct': 1,
                        'explanation': 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙÙˆØ± ØªÙˆÙØ± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ© Ù„Ø­Ù…Ø§ÙŠØ© Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ù† Ø§Ù„Ø«ØºØ±Ø§Øª'
                    },
                    {
                        'question': 'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©ØŸ',
                        'options': [
                            'Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…ØªÙŠ Ù…Ø±ÙˆØ±',
                            'Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© ØªØªØ·Ù„Ø¨ Ø±Ù…Ø² ØªØ£ÙƒÙŠØ¯',
                            'Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø¶Ø§Ø±Ø©',
                            'Ø·Ø±ÙŠÙ‚Ø© Ù„Ø­ÙØ¸ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±'
                        ],
                        'correct': 1,
                        'explanation': 'Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© ØªØ¶ÙŠÙ Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ø¨Ø± Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ£ÙƒÙŠØ¯ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±'
                    },
                    {
                        'question': 'Ø£ÙŠÙ‡Ù…Ø§ Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹ Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŸ',
                        'options': [
                            'Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ù€ http://',
                            'Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ù€ https://',
                            'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚',
                            'Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„'
                        ],
                        'correct': 1,
                        'explanation': 'Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ù€ https:// ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ´ÙÙŠØ± Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ù‚Ù„'
                    }
                ]
            },
            'advanced_security': {
                'title': 'ğŸ›¡ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…',
                'description': 'Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø±Ù‚Ù…ÙŠ',
                'difficulty': 'hard',
                'time_limit': 600,  # 10 Ø¯Ù‚Ø§Ø¦Ù‚
                'questions': [
                    {
                        'question': 'Ù…Ø§ Ù‡Ùˆ VPN ÙˆÙ…Ø§ ÙØ§Ø¦Ø¯ØªÙ‡ØŸ',
                        'options': [
                            'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
                            'Ø´Ø¨ÙƒØ© Ø®Ø§ØµØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø®ØµÙˆØµÙŠØ©',
                            'Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª',
                            'Ø·Ø±ÙŠÙ‚Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª'
                        ],
                        'correct': 1,
                        'explanation': 'VPN ÙŠØ´ÙØ± Ø§ØªØµØ§Ù„Ùƒ ÙˆÙŠØ®ÙÙŠ Ø¹Ù†ÙˆØ§Ù† IP Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØªÙƒ'
                    },
                    {
                        'question': 'Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ´ÙÙŠØ± Ù…Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŸ',
                        'options': [
                            'ØªØ´ÙÙŠØ± ÙŠØ­Ù…ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙÙ‚Ø·',
                            'ØªØ´ÙÙŠØ± ÙŠØ­Ù…ÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Øµ Ø§Ù„ØµÙ„Ø¨',
                            'Ù†ÙˆØ¹ Ù…Ù† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±',
                            'Ø·Ø±ÙŠÙ‚Ø© Ù„Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª'
                        ],
                        'correct': 0,
                        'explanation': 'Ø§Ù„ØªØ´ÙÙŠØ± Ù…Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¶Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø´ÙØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø±Ø³Ù„ Ø­ØªÙ‰ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„'
                    },
                    {
                        'question': 'Ù…Ø§ Ù‡Ùˆ Zero-Day AttackØŸ',
                        'options': [
                            'Ù‡Ø¬ÙˆÙ… ÙŠØ­Ø¯Ø« ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ù„Ø´Ù‡Ø±',
                            'Ù‡Ø¬ÙˆÙ… ÙŠØ³ØªØºÙ„ Ø«ØºØ±Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©',
                            'Ù‡Ø¬ÙˆÙ… Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª',
                            'Ù‡Ø¬ÙˆÙ… ÙŠØ³ØªØºØ±Ù‚ ØµÙØ± Ø«Ø§Ù†ÙŠØ©'
                        ],
                        'correct': 1,
                        'explanation': 'Zero-Day Attack ÙŠØ³ØªØºÙ„ Ø«ØºØ±Ø© Ø£Ù…Ù†ÙŠØ© Ù„Ù… ÙŠØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡Ø§ Ø£Ùˆ Ø¥ØµÙ„Ø§Ø­Ù‡Ø§ Ø¨Ø¹Ø¯'
                    }
                ]
            },
            'phishing_awareness': {
                'title': 'ğŸ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø§Ù„Ø®Ø¯Ø§Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'description': 'ØªØ¹Ù„Ù… ÙƒÙŠÙÙŠØ© Ø§ÙƒØªØ´Ø§Ù Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'difficulty': 'medium',
                'time_limit': 400,  # 6.5 Ø¯Ù‚ÙŠÙ‚Ø©
                'questions': [
                    {
                        'question': 'Ø£ÙŠ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ø®Ø¯Ø§Ø¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŸ',
                        'options': [
                            'Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                            'Ø£Ø®Ø·Ø§Ø¡ Ø¥Ù…Ù„Ø§Ø¦ÙŠØ© ÙˆÙ†Ø­ÙˆÙŠØ© ÙƒØ«ÙŠØ±Ø©',
                            'Ø±ÙˆØ§Ø¨Ø· Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø£Ùˆ Ù…Ø®ØªØµØ±Ø©',
                            'Ø¬Ù…ÙŠØ¹ Ù…Ø§ Ø³Ø¨Ù‚'
                        ],
                        'correct': 3,
                        'explanation': 'Ø¬Ù…ÙŠØ¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ØªØ¯Ù„ Ø¹Ù„Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© Ø®Ø¯Ø§Ø¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø­ØªÙ…Ù„Ø©'
                    },
                    {
                        'question': 'Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø¥Ø°Ø§ ØªÙ„Ù‚ÙŠØª Ø±Ø³Ø§Ù„Ø© ØªØ·Ù„Ø¨ Ù…Ù†Ùƒ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…ØµØ±ÙÙŠØŸ',
                        'options': [
                            'Ø£Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                            'Ø£ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ£ØªØµÙ„ Ø¨Ø§Ù„Ø¨Ù†Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©',
                            'Ø£Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
                            'Ø£Ø­ÙˆÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ'
                        ],
                        'correct': 1,
                        'explanation': 'Ø§Ù„Ø¨Ù†ÙˆÙƒ Ù„Ø§ ØªØ·Ù„Ø¨ Ø£Ø¨Ø¯Ø§Ù‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø³Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø§ØªØµÙ„ Ø¨Ù‡Ù… Ù…Ø¨Ø§Ø´Ø±Ø©'
                    }
                ]
            }
        }
        
    async def get_available_quizzes(self) -> discord.Embed:
        """Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©"""
        embed = discord.Embed(
            title="ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©",
            description="Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ø¹Ø±ÙØªÙƒ Ø§Ù„Ø£Ù…Ù†ÙŠØ©",
            color=Config.COLORS['info']
        )
        
        for quiz_id, quiz in self.quizzes.items():
            difficulty_emoji = {
                'easy': 'ğŸŸ¢',
                'medium': 'ğŸŸ¡', 
                'hard': 'ğŸ”´'
            }.get(quiz['difficulty'], 'âšª')
            
            embed.add_field(
                name=f"{difficulty_emoji} {quiz['title']}",
                value=f"{quiz['description']}\nğŸ“Š Ø§Ù„ØµØ¹ÙˆØ¨Ø©: {quiz['difficulty']}\nâ±ï¸ Ø§Ù„ÙˆÙ‚Øª: {quiz['time_limit']//60} Ø¯Ù‚Ø§Ø¦Ù‚\nâ“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: {len(quiz['questions'])}",
                inline=False
            )
            
        return embed
        
    async def start_quiz(self, user_id: int, quiz_id: str) -> discord.Embed:
        """Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø±"""
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        if quiz_id not in self.quizzes:
            return discord.Embed(
                title="âŒ Ø®Ø·Ø£",
                description="Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯",
                color=Config.COLORS['error']
            )
            
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙØªØ±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        if await self._is_on_cooldown(user_id):
            remaining = await self._get_cooldown_remaining(user_id)
            return discord.Embed(
                title="â° Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹",
                description=f"ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¢Ø®Ø± Ø¨Ø¹Ø¯ {remaining} Ø«Ø§Ù†ÙŠØ©",
                color=Config.COLORS['warning']
            )
            
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø´Ø·
        if user_id in self.active_quizzes:
            return discord.Embed(
                title="ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø´Ø·",
                description="Ù„Ø¯ÙŠÙƒ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø´Ø· Ø¨Ø§Ù„ÙØ¹Ù„. Ø£ÙƒÙ…Ù„Ù‡ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… `!quiz_cancel` Ù„Ø¥Ù„ØºØ§Ø¦Ù‡",
                color=Config.COLORS['warning']
            )

        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
        quiz_data = self.quizzes.get(quiz_id)
        if not quiz_data:
            return discord.Embed(
                title="âŒ Ø®Ø·Ø£",
                description="Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± ØµØ§Ù„Ø­",
                color=Config.COLORS['error']
            )

        # Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        self.active_quizzes[user_id] = {
            'quiz_type': quiz_id,
            'current_question': 0,
            'correct_answers': 0,
            'start_time': datetime.now(),
            'time_limit': quiz_data['time_limit']
        }

        return self._create_question_embed(user_id)